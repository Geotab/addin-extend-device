"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}geotab.addin.addinExtendDevice=function(){var e="a8sQ4W7bK5Uy6HOnUTAHlJw",t=void 0,n=void 0,i=function s(e,t,n){_classCallCheck(this,s),this.key=e,this.value=t,this.isSaved=n},r={fetch:function(n){return new Promise(function(r,o){t.call("Get",{typeName:"AddInData",search:{addInId:e,whereClause:'device.id = "'+n+'"'}},function(e){var t=null,n=[];if(e.length>0){var o=JSON.parse(e[0].data);n=Object.keys(o.properties||{}).map(function(e){return new i(e,o.properties[e],(!0))}),t=e[0].id}else t=null;n.push(new i("","",(!1))),r({propertiesId:t,properties:n})},o)})},save:function(n,i,r){var o=function(n,i){return new Promise(function(r,o){var a={};i.forEach(function(e){e.key&&(a[e.key]=e.value)}),t.call("Add",{typeName:"AddInData",entity:{addInId:e,groups:[{id:"GroupCompanyId"}],data:JSON.stringify({device:{id:n},properties:a})}},r,o)})},a=function(n){return new Promise(function(i,r){return n?void t.call("Remove",{typeName:"AddInData",entity:{id:n,addInId:e}},i,r):i()})};return a(i).then(o(n,r))}},o=void 0,a=function(e){clearTimeout(o),n.error={message:e,isHidden:!1},o=setTimeout(function(){n.error.isHidden=!0},5e3)};return{initialize:function(e,t,i){n=new Vue({el:"#addinExtendDevice",data:{error:{message:"",isHidden:!0},selected:null,newProperty:{},devices:[],properties:[],propertiesId:null},methods:{remove:function(e){var t=n.properties.indexOf(e);n.properties.splice(t,1),r.save(n.selected,n.propertiesId,n.properties)["catch"](a)},edit:function(e){e.isSaved&&e.key&&r.save(n.selected,n.propertiesId,n.properties)["catch"](a)},add:function(e){e.key&&r.save(n.selected,n.propertiesId,n.properties).then(function(e){e&&(n.propertiesId=e),n.properties.forEach(function(e){e.isSaved=!0}),n.properties.push({key:null,value:null,isSaved:!1})})["catch"](a)}},watch:{selected:function(e,t){e&&e!==t&&r.fetch(e).then(function(e){n.properties=e.properties,n.propertiesId=e.propertiesId})["catch"](a)}}}),i()},focus:function(e,i){t=e,t.call("Get",{typeName:"Device",resultsLimit:500,search:{fromDate:(new Date).toISOString(),groups:i.getGroupFilter()}},function(e){e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),n.devices=e},a)},blur:function(){}}};