"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}geotab.addin.addinExtendDevice=function(){var e="a8sQ4W7bK5Uy6HOnUTAHlJw",t=void 0,n=void 0,r=function s(e,t,n){_classCallCheck(this,s),this.key=e,this.value=t,this.isSaved=n},i={fetch:function(n){return new Promise(function(i,o){t.call("Get",{typeName:"AddInData",search:{addInId:e,whereClause:'device.id = "'+n+'"'}},function(e){var t=null,n=[];if(e.length>0){var o=JSON.parse(e[0].data);n=Object.keys(o.properties||{}).map(function(e){return new r(e,o.properties[e],(!0))}),t=e[0].id}else t=null;n.push(new r("","",(!1))),i({propertiesId:t,properties:n})},o)})},save:function(n,r,i){var o=function(n,r){return new Promise(function(i,o){var a={};r.forEach(function(e){e.key&&(a[e.key]=e.value)}),t.call("Add",{typeName:"AddInData",entity:{addInId:e,groups:[{id:"GroupCompanyId"}],data:JSON.stringify({device:{id:n},properties:a})}},i,o)})},a=function(n){return new Promise(function(r,i){return n?void t.call("Remove",{typeName:"AddInData",entity:{id:n,addInId:e}},r,i):r()})};return a(r).then(o(n,i))}},o=void 0,a=function(e){clearTimeout(o),n.errorMessage=e,o=setTimeout(function(){n.errorMessage=" "},5e3)};return{initialize:function(e,t,r){n=new Vue({el:"#addinExtendDevice",data:{errorMessage:" ",selected:null,newProperty:{},devices:[],properties:[],propertiesId:null},methods:{remove:function(e){var t=n.properties.indexOf(e);n.properties.splice(t,1),i.save(n.selected,n.propertiesId,n.properties)["catch"](a)},edit:function(e){e.isSaved&&e.key&&i.save(n.selected,n.propertiesId,n.properties)["catch"](a)},add:function(e){e.key&&i.save(n.selected,n.propertiesId,n.properties).then(function(e){e&&(n.propertiesId=e),n.properties.forEach(function(e){e.isSaved=!0}),n.properties.push({key:null,value:null,isSaved:!1})})["catch"](a)}},watch:{selected:function(e,t){e&&e!==t&&i.fetch(e).then(function(e){n.properties=e.properties,n.propertiesId=e.propertiesId})["catch"](a)}}}),r()},focus:function(e,r){t=e,t.call("Get",{typeName:"Device",resultsLimit:500,search:{fromDate:(new Date).toISOString(),groups:r.getGroupFilter()}},function(e){e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),n.devices=e},a)},blur:function(){}}};