"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}geotab.addin.addinExtendDevice=function(){var e="a8sQ4W7bK5Uy6HOnUTAHlJw",t=void 0,n=void 0,i=void 0,r=function c(e,t,n){_classCallCheck(this,c),this.key=e,this.value=t,this.isSaved=n},a={fetch:function(n){return new Promise(function(i,a){t.call("Get",{typeName:"AddInData",search:{addInId:e,whereClause:'device.id = "'+n+'"'}},function(e){var t=null,n=[];if(e.length>0){var a=JSON.parse(e[0].data);n=Object.keys(a.properties||{}).map(function(e){return new r(e,a.properties[e],(!0))}),t=e[0].id}else t=null;n.push(new r("","",(!1))),i({propertiesId:t,properties:n})},a)})},save:function(n,i,r){var a=function(n,i){return new Promise(function(r,a){var o={};i.forEach(function(e){e.key&&(o[e.key]=e.value)}),t.call("Add",{typeName:"AddInData",entity:{addInId:e,groups:[{id:"GroupCompanyId"}],data:JSON.stringify({device:{id:n},properties:o})}},r,a)})},o=function(n){return new Promise(function(i,r){return n?void t.call("Remove",{typeName:"AddInData",entity:{id:n,addInId:e}},i,r):i()})};return o(i).then(a(n,r))}},o=void 0,s=function(e){clearTimeout(o),i.error={message:e,isHidden:!1},o=setTimeout(function(){i.error.isHidden=!0},5e3)};return{initialize:function(e,t,r){i=new Vue({el:"#addinExtendDevice",data:{error:{message:"",isHidden:!0},selected:null,newProperty:{},devices:[],properties:[],propertiesId:null},methods:{remove:function(e){var t=i.properties.indexOf(e);i.properties.splice(t,1),a.save(i.selected,i.propertiesId,i.properties)["catch"](s)},edit:function(e){e.isSaved&&e.key&&a.save(i.selected,i.propertiesId,i.properties)["catch"](s)},add:function(e){e.key&&a.save(i.selected,i.propertiesId,i.properties).then(function(e){e&&(i.propertiesId=e),i.properties.forEach(function(e){e.isSaved=!0}),i.properties.push({key:null,value:null,isSaved:!1})})["catch"](s)}},watch:{selected:function(e,t){e&&e!==t&&(n.setState({device:e}),a.fetch(e).then(function(e){i.properties=e.properties,i.propertiesId=e.propertiesId})["catch"](s))}}}),r()},focus:function(e,r){t=e,n=r,t.call("Get",{typeName:"Device",resultsLimit:500,search:{fromDate:(new Date).toISOString(),groups:n.getGroupFilter()}},function(e){e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),i.devices=e;var t=n.getState();t.device&&(i.selected=t.device)},s)},blur:function(){}}};